<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Electricity Market Operations Unit — Meeting Notes</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0f172a;          /* slate-900 */
      --card:#111827;        /* gray-900 */
      --muted:#94a3b8;       /* slate-400 */
      --text:#e5e7eb;        /* gray-200 */
      --accent:#22c55e;      /* green-500 */
      --accent-2:#38bdf8;    /* sky-400 */
      --border:#1f2937;      /* gray-800 */
      --chip:#0b1220;        /* dark chip */
      --warn:#f59e0b;        /* amber-500 */
    }
    *{ box-sizing: border-box; }
    html,body{ height:100%; }
    body{
      margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      background:linear-gradient(180deg, #0b1020, #0f172a 50%, #0b1020);
      color:var(--text);
    }
    .container{ max-width: 1100px; margin: 32px auto; padding: 0 16px; }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px; margin-bottom:16px;
    }
    .title{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
    }
    h1{ font-size: clamp(22px, 3.8vw, 34px); margin:0; font-weight:700; letter-spacing:0.2px; }
    .chip{ font-size:12px; padding:6px 10px; background:var(--chip); border:1px solid var(--border); border-radius:999px; color:var(--muted); }

    .toolbar{ display:flex; flex-wrap:wrap; gap:8px; }
    button, .btn{
      appearance:none; border:1px solid var(--border); background:#0a0f1f; color:var(--text);
      padding:10px 14px; border-radius:12px; font-weight:600; cursor:pointer; transition: .2s ease; font-size:14px;
    }
    button:hover, .btn:hover{ transform: translateY(-1px); border-color:#243041; }
    .btn-accent{ background: linear-gradient(135deg, #16a34a, #22c55e); color:#08130b; border-color:transparent; }
    .btn-sky{ background: linear-gradient(135deg, #0284c7, #38bdf8); color:#02131d; border-color:transparent; }
    .btn-amber{ background: linear-gradient(135deg, #b45309, #f59e0b); color:#1a1003; border-color:transparent; }

    .grid{ display:grid; grid-template-columns: 1fr; gap:16px; }
    @media (min-width: 880px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .card{
      background: radial-gradient(1200px 600px at -10% -20%, #0b1220 0%, #0a0f1f 35%, #0a0e1c 60%) , var(--card);
      border:1px solid var(--border); border-radius:20px; padding:18px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .card h2{ margin:0 0 12px 0; font-size:18px; letter-spacing:.2px; }
    label{ display:block; font-size:12px; color:var(--muted); margin-bottom:6px; }
    input[type="text"], input[type="date"], input[type="time"], textarea{
      width:100%; padding:12px 12px; border-radius:12px; border:1px solid var(--border); background:#0a0f1f; color:var(--text);
      outline:none; font-size:14px;
    }
    textarea{ min-height: 140px; resize: vertical; }

    .row{ display:grid; grid-template-columns: 1fr 1fr; gap:10px; }

    table{ width:100%; border-collapse: collapse; }
    th, td{ border-bottom: 1px dashed #1e293b; padding:10px; font-size:14px; }
    th{ text-align:left; color:var(--muted); font-weight:600; }
    tr:last-child td{ border-bottom: none; }
    .tiny{ font-size:12px; color:var(--muted); }

    .footer{ margin-top:18px; display:flex; flex-wrap:wrap; gap:8px; align-items:center; justify-content:space-between; }

    .print-only{ display:none; }
    @media print{
      body{ background:#fff; color:#000; }
      header, .footer, .toolbar, .no-print{ display:none !important; }
      .card{ box-shadow:none; border:1px solid #bbb; }
      .print-only{ display:block; }
      a{ color:#000; }
    }
    .hint{ color:var(--muted); font-size:12px; margin-top:8px; }
    .pill{ display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; border:1px dashed #22314a; color:#98a3b6; font-size:12px; }
    .kbd{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; background:#0c1526; border:1px solid #1f2b43; padding:1px 6px; border-radius:6px; }
    .section-actions{ display:flex; gap:8px; flex-wrap:wrap; }
    .muted{ color:var(--muted); }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="title">
        <h1>Electricity Market Operations Unit — Meeting Notes</h1>
        <span class="chip">v1.0</span>
      </div>
      <div class="toolbar no-print">
        <button class="btn-accent" id="btn-pdf" title="Download PDF">Download PDF</button>
        <button class="btn-sky" id="btn-email" title="Create email draft">Email</button>
        <button class="btn-amber" id="btn-whatsapp" title="Share to WhatsApp">WhatsApp</button>
        <button id="btn-save" title="Save to browser">Save</button>
        <button id="btn-load" title="Load from browser">Load</button>
        <button id="btn-export" title="Export .json">Export</button>
        <label for="import-json" class="btn" style="cursor:pointer;">Import</label>
        <input id="import-json" type="file" accept="application/json" style="display:none" />
        <button id="btn-clear" title="Clear all">Clear</button>
      </div>
    </header>

    <div class="card">
      <div class="row">
        <div>
          <label>Meeting title</label>
          <input type="text" id="title" placeholder="e.g., Weekly Ops Sync" />
        </div>
        <div>
          <label>Location / Platform</label>
          <input type="text" id="location" placeholder="Conference Room 2B / Teams" />
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <div>
          <label>Date</label>
          <input type="date" id="date" />
        </div>
        <div class="row" style="grid-template-columns:1fr 1fr;">
          <div>
            <label>Start time</label>
            <input type="time" id="start" />
          </div>
          <div>
            <label>End time</label>
            <input type="time" id="end" />
          </div>
        </div>
      </div>
      <div style="margin-top:10px;">
        <label>Facilitator</label>
        <input type="text" id="facilitator" placeholder="Name" />
      </div>
      <div style="margin-top:10px;">
        <label>Attendees</label>
        <input type="text" id="attendees" placeholder="List names, teams, emails" />
      </div>
      <div class="hint">Tip: Use <span class="kbd">Tab</span> between fields; press <span class="kbd">Ctrl/Cmd + P</span> to print.</div>
    </div>

    <div class="grid" style="margin-top:16px;">
      <section class="card">
        <h2>Agenda</h2>
        <textarea id="agenda" placeholder="Bullet points of topics to cover"></textarea>
        <div class="section-actions no-print">
          <button onclick="toBullets('agenda')">Make bullets</button>
          <span class="tiny">Keep it crisp—each line becomes a bullet in exports.</span>
        </div>
      </section>

      <section class="card">
        <h2>Key Updates</h2>
        <textarea id="updates" placeholder="Brief status notes"></textarea>
        <div class="section-actions no-print"><button onclick="toBullets('updates')">Make bullets</button></div>
      </section>

      <section class="card" style="grid-column:1/-1;">
        <h2>Discussion</h2>
        <textarea id="discussion" placeholder="Notes, viewpoints, data points"></textarea>
      </section>

      <section class="card" style="grid-column:1/-1;">
        <h2>Decisions</h2>
        <textarea id="decisions" placeholder="What was decided and why"></textarea>
        <div class="section-actions no-print"><button onclick="toBullets('decisions')">Make bullets</button></div>
      </section>

      <section class="card" style="grid-column:1/-1;">
        <h2>Action Items</h2>
        <table id="actions-table">
          <thead>
            <tr>
              <th>Task</th>
              <th>Owner</th>
              <th>Due</th>
              <th>Status</th>
              <th class="no-print">—</th>
            </tr>
          </thead>
          <tbody id="actions-body"></tbody>
        </table>
        <div class="section-actions no-print" style="margin-top:10px;">
          <button onclick="addAction()">Add row</button>
          <button onclick="fillStatus()">Quick status ➜</button>
          <span class="tiny">Statuses: Not started · In progress · Done</span>
        </div>
      </section>

      <section class="card">
        <h2>Risks & Watchlist</h2>
        <textarea id="risks" placeholder="Key risks, mitigations, dependencies"></textarea>
        <div class="section-actions no-print"><button onclick="toBullets('risks')">Make bullets</button></div>
      </section>

      <section class="card">
        <h2>Next Meeting</h2>
        <label>Proposed date</label>
        <input type="date" id="nextDate" />
        <label style="margin-top:8px;">Notes</label>
        <textarea id="nextNotes" placeholder="Agenda seeds / prep items"></textarea>
      </section>
    </div>

    <div class="card" style="margin-top:16px;">
      <h2>Preview (auto‑generated)</h2>
      <div id="preview" class="muted">Start typing to see a preview…</div>
      <div class="footer no-print">
        <div class="pill">Export scope: the content above will be used for PDF / Email / WhatsApp</div>
        <button id="btn-refresh">Refresh Preview</button>
      </div>
    </div>

    <p class="tiny no-print" style="text-align:center; margin-top:12px;">Made for EMOU. Single‑file HTML — safe to host on GitHub Pages.</p>
  </div>

  <!-- html2pdf for PDF export -->
  <script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
  <script>
    // === Helpers ===
    function $(id){ return document.getElementById(id); }
    function val(id){ return ($(id)?.value || '').trim(); }
    function lines(text){ return text.split(/\r?\n/).map(s=>s.trim()).filter(Boolean); }
    function toBullets(id){
      const v = val(id);
      if(!v) return;
      const out = lines(v).map(s => s.startsWith('- ') || s.startsWith('• ') ? s : ('- ' + s)).join('\n');
      $(id).value = out; refresh();
    }

    // === Action Items table ===
    function addAction(obj){
      const tbody = $('actions-body');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><input type="text" placeholder="Task"/></td>
        <td><input type="text" placeholder="Owner"/></td>
        <td><input type="date"/></td>
        <td>
          <select>
            <option>Not started</option>
            <option>In progress</option>
            <option>Done</option>
          </select>
        </td>
        <td class="no-print"><button onclick="this.closest('tr').remove()">Remove</button></td>
      `;
      tbody.appendChild(tr);
      if(obj){
        tr.querySelectorAll('input,select')[0].value = obj.task || '';
        tr.querySelectorAll('input,select')[1].value = obj.owner || '';
        tr.querySelectorAll('input,select')[2].value = obj.due || '';
        tr.querySelectorAll('input,select')[3].value = obj.status || 'Not started';
      }
    }
    function fillStatus(){
      [...document.querySelectorAll('#actions-body select')].forEach((sel,i)=>{
        if(sel.value === 'Not started' && i===0) sel.value = 'In progress';
      });
    }

    // === Data model ===
    function collect(){
      const actions = [...document.querySelectorAll('#actions-body tr')].map(tr=>{
        const [task, owner, due, status] = tr.querySelectorAll('input,select');
        return { task: task.value.trim(), owner: owner.value.trim(), due: due.value, status: status.value };
      }).filter(a=>a.task);
      return {
        meta:{ version:'1.0', savedAt: new Date().toISOString() },
        title: val('title'), location: val('location'), date: val('date'), start: val('start'), end: val('end'), facilitator: val('facilitator'), attendees: val('attendees'),
        agenda: val('agenda'), updates: val('updates'), discussion: val('discussion'), decisions: val('decisions'), actions, risks: val('risks'), nextDate: val('nextDate'), nextNotes: val('nextNotes')
      };
    }

    function apply(data){
      if(!data) return;
      $('title').value = data.title || '';
      $('location').value = data.location || '';
      $('date').value = data.date || '';
      $('start').value = data.start || '';
      $('end').value = data.end || '';
      $('facilitator').value = data.facilitator || '';
      $('attendees').value = data.attendees || '';
      $('agenda').value = data.agenda || '';
      $('updates').value = data.updates || '';
      $('discussion').value = data.discussion || '';
      $('decisions').value = data.decisions || '';
      $('risks').value = data.risks || '';
      $('nextDate').value = data.nextDate || '';
      $('nextNotes').value = data.nextNotes || '';

      $('actions-body').innerHTML='';
      (data.actions||[]).forEach(addAction);
      if((data.actions||[]).length===0) addAction();
      refresh();
    }

    // === Preview / Export text ===
    function makeText(d){
      const pad = (s)=> s? s+"\n" : '';
      const bullets = (s)=> lines(s).map(x => `• ${x.replace(/^[-•]\s?/, '')}`).join('\n');
      const actions = (d.actions||[]).map((a,i)=> `${i+1}. ${a.task} — ${a.owner}${a.due? ' (due '+a.due+')':''} [${a.status}]`).join('\n');
      return (
`Electricity Market Operations Unit — Meeting Notes\n\n`+
(d.title? `Title: ${d.title}\n` : '')+
(d.date? `Date: ${d.date}`: '')+ (d.start||d.end? `  Time: ${d.start||''}${d.end? '–'+d.end:''}\n`:'\n')+
(d.location? `Location: ${d.location}\n`: '')+
(d.facilitator? `Facilitator: ${d.facilitator}\n`: '')+
(d.attendees? `Attendees: ${d.attendees}\n\n`:'\n')+
(d.agenda? `Agenda:\n${bullets(d.agenda)}\n\n`: '')+
(d.updates? `Key Updates:\n${bullets(d.updates)}\n\n`: '')+
(d.discussion? `Discussion:\n${pad(d.discussion)}`: '')+
(d.decisions? `Decisions:\n${bullets(d.decisions)}\n\n`: '')+
((d.actions||[]).length? `Action Items:\n${actions}\n\n`:'')+
(d.risks? `Risks & Watchlist:\n${bullets(d.risks)}\n\n`: '')+
(d.nextDate||d.nextNotes? `Next Meeting: ${d.nextDate||''}\n${pad(d.nextNotes)}`:'')
      ).trim();
    }

    function refresh(){
      const data = collect();
      const text = makeText(data).replace(/\n/g,'<br>');
      $('preview').innerHTML = text || '<span class="muted">Start typing to see a preview…</span>';
    }

    // === Storage ===
    const KEY='emou_meeting_notes_v1';
    $('btn-save').onclick = ()=>{ localStorage.setItem(KEY, JSON.stringify(collect())); toast('Saved to this browser'); };
    $('btn-load').onclick = ()=>{ const d = localStorage.getItem(KEY); if(d){ apply(JSON.parse(d)); toast('Loaded from this browser'); } };
    $('btn-export').onclick = ()=>{
      const blob = new Blob([JSON.stringify(collect(), null, 2)], {type:'application/json'});
      const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = (val('title')||'EMOU_Meeting')+".json"; a.click(); URL.revokeObjectURL(a.href);
    };
    $('import-json').onchange = (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const reader = new FileReader(); reader.onload = ()=>{ try{ apply(JSON.parse(reader.result)); toast('Imported'); }catch(err){ alert('Invalid JSON'); } };
      reader.readAsText(file);
    };
    $('btn-clear').onclick = ()=>{ if(confirm('Clear all fields?')){ localStorage.removeItem(KEY); document.querySelectorAll('input, textarea').forEach(el=> el.value=''); $('actions-body').innerHTML=''; addAction(); refresh(); } };

    // === Exports ===
    $('btn-pdf').onclick = ()=>{
      const data = collect();
      const wrapper = document.createElement('div');
      wrapper.style.padding = '24px';
      wrapper.style.fontFamily = 'Inter, Arial, sans-serif';
      wrapper.style.color = '#111';
      wrapper.innerHTML = `
        <h1 style="margin:0 0 8px 0; font-size:22px;">Electricity Market Operations Unit — Meeting Notes</h1>
        <div style="font-size:12px; color:#555">Generated ${new Date().toLocaleString()}</div>
        <hr style="margin:12px 0 18px; border:none; border-bottom:1px solid #ddd;"/>
        <pre style="white-space:pre-wrap; font-family: ui-monospace,Menlo,Consolas,monospace;">${makeText(data)}</pre>
      `;
      html2pdf().from(wrapper).set({
        margin: 10, filename: (data.title||'EMOU_Meeting_Notes')+'.pdf', image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).save();
    };

    $('btn-email').onclick = ()=>{
      const d = collect();
      const subject = encodeURIComponent(`[EMOU] ${d.title || 'Meeting Notes'} — ${d.date || ''}`.trim());
      const body = encodeURIComponent(makeText(d));
      window.location.href = `mailto:?subject=${subject}&body=${body}`;
    };

    $('btn-whatsapp').onclick = ()=>{
      const d = collect();
      const text = encodeURIComponent(makeText(d));
      const url = `https://wa.me/?text=${text}`; // works on mobile & desktop (opens Web WhatsApp)
      window.open(url, '_blank');
    };

    $('btn-refresh').onclick = refresh;

    // Live preview
    document.addEventListener('input', (e)=>{
      if(['INPUT','TEXTAREA','SELECT'].includes(e.target.tagName)) refresh();
    });

    function toast(msg){
      const t = document.createElement('div');
      t.textContent = msg;
      t.style.position='fixed'; t.style.bottom='20px'; t.style.left='50%'; t.style.transform='translateX(-50%)';
      t.style.background='#0b1220'; t.style.border='1px solid #22314a'; t.style.color='#cfe1ff'; t.style.padding='10px 14px'; t.style.borderRadius='12px'; t.style.fontSize='13px'; t.style.boxShadow='0 6px 20px rgba(0,0,0,.35)';
      document.body.appendChild(t); setTimeout(()=> t.remove(), 1400);
    }

    // Initialize
    (function init(){
      const today = new Date();
      $('date').valueAsDate = today;
      addAction(); refresh();
    })();
  </script>
</body>
</html>
